<!DOCTYPE html>
<!--
  Copyright 2018 Peter W Leong
-->
<!--suppress CheckEmptyScriptTag -->
<html>
<head>
    <title>beatfix.live</title>
    <meta charset="utf-8"/>
    <script type="application/javascript">
        if (window.attachEvent) {
            window.attachEvent('onresize', resizeSvg);
        }
        else if (window.addEventListener) {
            window.addEventListener('resize', resizeSvg, true);
        }
        else {
            //The browser does not support Javascript event binding
        }

        function resizeSvg() {
            var side = Math.min(window.innerHeight, window.innerWidth);
            theSvg.setAttribute("height", side.toString());
            theSvg.setAttribute("width", side.toString());
        }

        function tempoChange(delta) {
            setRate(rate + delta);
        }

        function sync() {
            if (rate < 10) rate = 10;
            if (rate > 180) rate = 180;
            theTempoText.innerHTML = rate.toString();
            theRatioText.innerHTML = "x" + displayRatio.toString();
            var dur = 60 * displayRatio / rate;
            var durStr = dur.toString() + "s";
            theTiming.setAttribute("dur", durStr);

            var sectionRatio = 1 / 2 / displayRatio;
            var section = circumference * sectionRatio;
            var gap = section * gapPortion;
            var line = section - gap;

            var lineStr = line.toString();
            theCircle.setAttribute("stroke-dasharray", lineStr + "," + (section - line).toString());
            var rotorDash = (line).toString() + "," + circumference.toString();
            theRotor.setAttribute("stroke-dasharray", rotorDash);

            var rotate = 90 + (gap / 2 * 360 / circumference);
            theCircle.setAttribute("transform", "rotate(" + rotate.toString() + ",120,120)");
        }

        function setRate(i) {
            rate = i;
            sync();
        }

        function readTempo() {
            var desired = prompt("Desired tempo", rate.toString());
            if (desired != null) {
                var i = parseInt(desired);
                if (!isNaN(i)) {
                    setRate(i);
                }
            }
        }

        function toggleDisplayRatio() {
            if (displayRatio === 5) displayRatio = 3;
            else if (displayRatio === 4) displayRatio = 5;
            else displayRatio = 4;
            sync();
        }

        function showInfo() {
            var year = new Date().getFullYear();
            alert("Copyright " + year.toString() + " Peter W Leong\n\n   http://beatfix.live");
        }
    </script>
    <style type="text/css">
        body {
            background-color: #000000;
            overflow: hidden;
        }

        text {
            text-anchor: middle;
            dominant-baseline: central;
            fill: green;
            font-family: Arial, Helvetica, sans-serif;

            /* Prevent selection */
            -moz-user-select: -moz-none;
            -khtml-user-select: none;
            -webkit-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
    </style>
</head>
<body>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 245 245">
    <g>
        <circle cx="120" cy="120" r="105" fill="none" stroke="gold" stroke-dasharray="43,700" stroke-width="20"
                stroke-linecap="butt" id="rotor"/>
        <animateTransform id="timing"
                          attributeType="xml"
                          attributeName="transform"
                          type="rotate"
                          from="0 120 120"
                          to="360 120 120"
                          dur="3s"
                          repeatCount="indefinite"/>
    </g>
    <circle cx="120" cy="120" r="105" fill="none" stroke="#333" stroke-dasharray="43,12" stroke-width="21"
            stroke-linecap="butt" id="circle"/>

    <text x="120" y="120" style="font-size:450%" onclick="readTempo()" id="tempoText">199</text>
    <text x="90" y="65" style="font-size: 250%" onclick="tempoChange(5)">&nbsp;+</text>
    <text x="90" y="175" style="font-size: 250%" onclick="tempoChange(-5)">&nbsp;-</text>
    <text x="150" y="65" style="font-size: 250%" onclick="tempoChange(1)">+&nbsp;</text>
    <text x="150" y="175" style="font-size: 250%" onclick="tempoChange(-1)">-&nbsp;</text>
    <text x="20" y="223" style="font-size: 200%" onclick="showInfo()">&copy;</text>
    <text x="220" y="220" style="font-size: 250%" onclick="toggleDisplayRatio()" id="ratioText">x?</text>
</svg>
<script type="application/javascript">
    var theSvg = document.getElementsByTagName("svg").item(0);
    var theTiming = document.getElementById("timing");
    var theTempoText = document.getElementById("tempoText");
    var theRatioText = document.getElementById("ratioText");
    var theCircle = document.getElementById("circle");
    var theRotor = document.getElementById("rotor");
    var rate = 80;
    var displayRatio = 4;
    var circumference = Math.PI * 2 * 105; // radius of circle
    var gapPortion = .2;
    resizeSvg();
    sync();
</script>
</body>
</html>
