<html>
<head>
    <title>Custom Field</title>
    <link rel="stylesheet" type="text/css" href="../../../extjs-4.0/resources/css/ext-all.css">
    <script type="text/javascript" src="../../../extjs-4.0/ext-debug.js"></script>
    <script type="text/javascript" src="../../../app.js"></script>
    <script type="text/javascript">

        /**
         * A number between 0 and 1 behind the scenes but a whole percent number to the user.
         */
        var Percent = {
            REG_EXP: /^ *(\d?\d|100)%? *$/,
            toText: function(d) {
                return '' + Math.round(d * 100) + '%';
            },
            fromText: function(s) {
                var match = Percent.REG_EXP.exec(s);
                if (match === null) return NaN; // not sure about this
                return parseInt(match[1]) / 100;
            }
        };

        // TODO: Slider stuff.
        /**
         * A number field with a slider underneath for small adjustments.
         * NOTE: vTypes don't seem to have a string<->altValue conversion like valueToRaw() and rawToValue() so can't use.
         */
        Ext.define('PercentField', {
            extend: 'Ext.form.field.Text',
            alias: 'widget.percentfield',
            regex: Percent.REG_EXP,
            regexText: 'Must be between 0% and 100% inclusive, no decimals, "%" optional.',
            rawToValue: Percent.fromText,
            valueToRaw: Percent.toText
        });

        Ext.onReady(function() {
            CONFIG.centerConfig = {
                xtype: 'form',
//                layout: 'fit',
                url: calcPathToRoot() + "/echo",
                autoScroll: true,
                autoHeight: true,
                defaults: {
                    msgTarget : 'side',
                    anchor: '90%'
                },
                items: [
                    {
                        xtype: 'numberfield',
                        name: 'mynumber',
                        fieldLabel: 'My Number',
                        value: 99,
                        maxValue: 100,
                        minValue: 0,
                        allowBlank: false
                    },
                    {
                        xtype: 'percentfield',
                        name: 'mypercent',
                        fieldLabel: 'My Percent',
                        value: 0.23,
                        allowBlank: false
                    }
                ],
// Reset and Submit buttons
                buttons: [
                    {
                        text: 'Reset',
                        handler: function() {
                            this.up('form').getForm().reset();
                        }
                    },
                    {
                        text: 'Submit',
                        formBind: true, //only enabled once the form is valid
                        disabled: true,
                        handler: function() {
                            var form = this.up('form').getForm();
                            if (form.isValid()) {
                                var values = form.getFieldValues();
                                log("Values: ", values);
                                Ext.Msg.show({
                                    msg: Ext.encode(values),
                                    closable: true
                                });
                            }
                        }
                    }
                ]
            };
            var LE = createApp();
        });
    </script>
</head>
<body>
</body>
</html>