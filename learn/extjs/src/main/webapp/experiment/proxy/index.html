<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <title>Proxy Examples</title>
    <link rel="stylesheet" type="text/css" href="../../extjs-4.0/resources/css/ext-all.css">
    <script type="text/javascript" src="../../extjs-4.0/ext-debug.js"></script>
    <script type="text/javascript" src="../../app.js"></script>
    <script type="text/javascript">
        Ext.onReady(function() {
            var LE = createApp([], {
                html: '<p>This just does not work.  Memory proxy / store will not save.<br/>'
                        + 'It is like the proxy just gets ignored and the default ajax one is used.</p>',
                buttons: [
                    {
                        xtype: 'button',
                        text: 'Add to memory',
                        handler: function() {
                            log('Adding ...');
                            log('Current total count:', store.getTotalCount());

                            var user1 = store.getById(1);
                            log('Retrieved by id 1: ', user1);

                            var proxy = store.getProxy();
                            log("The store has proxy: ", proxy);
//                            var v = Ext.create('LE.model.Appointment', {
//                                description: 'Test New One',
//                                start: '123456789',
//                                duration: 'the duration'
////                                ,
////                                proxy: proxy
//                            });


                            var v = Ext.create('User', {
                                id: 3,
                                name: 'Ed Spencer',
                                phone: '123456789'
                            });

//                            log("Assigning proxy: ", proxy);
                            log("Instanciated ", v);
//                            v.setProxy(proxy);
//                            log("Assigned proxy ", v);
                            log('Interim total count:', store.getTotalCount());
//                            log('userArray length: ', userArray.length);


                            // We can save Ed directly without having to add him to a Store first because we
                            // configured a RestProxy this will automatically send a POST request to the url /users
                            var after = v.save({
                                success: function(record, operation) {
                                    log("Success function");
                                },
                                failure: function(record) {
                                    log("Failure function");
                                },
                                callback: function(records, operation, success) {
                                    log("In callback ", records, operation, success);
                                    if (success) log("Saved!");
                                    else log("Failed to add.");
                                }

                            });

                            store.sync();

                            log("After ", after);
                            log('After total count:', store.getTotalCount());
//                            log('userArray length: ', userArray.length);

                            var user3 = store.getById(3);
                            log('Retrieved by id 3: ', user3);

                            // Load User 1 and do something with it (performs a GET request to /users/1)
//                            User.load(1, {
//                                success: function(user) {
//                                    console.log("Loaded user 1: " + user.get('name'));
//                                }
//                            });
                        }
                    }
                ]
            });


            var data = [
                {
                    id: 1,
                    name: 'Ed Spencer',
                    phone: '555 1234'
                },
                {
                    id: 2,
                    name: 'Abe Elias',
                    phone: '666 1234'
                }
            ];

            var userDef = Ext.define('User', {
                extend: 'Ext.data.Model',
                fields: [
                    {name: 'id',    type: 'int'},
                    {name: 'name',  type: 'string'},
                    {name: 'phone', type: 'string'}
                ],
//                proxy: store.getProxy()
                proxy: {type: 'memory'} // no effect..., data: data}
            });
            log("Created User: ", userDef);

            var store = Ext.create('Ext.data.Store', {
//                autoLoad: true,
//                autoSync: true,
                model: 'User',
                data : data // causes getTotalCount() to work
//                proxy: 'memory' // equivalent...{type: 'memory', reader: 'json', writer: 'json'}
//                proxy: Ext.create('Ext.data.proxy.Memory', {
//                    reader: {
//                        type: 'json',
//                        root: 'users'
//                    }
//                })
            });

            log("Created store: ", store);

//          no longer needed b/c proxy declared on User model
//            userDef.setProxy(store.getProxy()); // prevents 'url' error and proxy on new Users is 'memory', not 'ajax'.
//            log("Assigned proxy to model: ", userDef);

        });
    </script>
</head>
<body>
</body>
</html>